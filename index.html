<!DOCTYPE html>
<html>
<head>
	<title>VR Architectural Walkthrough with WebXR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Favicon Section -->
    <link rel="apple-touch-icon" sizes="180x180" href="./css/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./css/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./css/favicon/favicon-16x16.png">
    <link rel="manifest" href="./css/favicon/site.webmanifest">
    <link rel="mask-icon" href="./css/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <!-- end favicon -->
    
    <!-- A-Frame Libraries -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
    
    <link type="text/css" rel="stylesheet" href="./css/common.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .progress-bar {
            width: 300px;
            height: 20px;
            border: 2px solid #fff;
            margin-top: 20px;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: #4CAF50;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <h2>Loading VR Experience</h2>
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <a-scene 
        vr-mode-ui="enabled: true" 
        renderer="colorManagement: true; antialias: true"
        loading-screen="enabled: false"
        xr-mode
    >
        <!-- Asset Preloading -->
        <a-assets>
            <a-asset-item id="guard-model" src="models/guard.glb"></a-asset-item>
        </a-assets>

        <!-- Main 3D Model -->
        <a-entity
            id="arch-model"
            gltf-model="#guard-model"
            position="0 0.5 -5"
            scale="1 1 1"
            rotation="0 0 0"
            shadow="cast: true; receive: true"
        ></a-entity>

        <!-- Player/Camera Rig -->
        <a-entity id="player-rig" movement-controls="speed: 0.2">
            <a-entity 
                camera="active: true" 
                position="0 1.6 0"
                look-controls="pointerLockEnabled: true"
            ></a-entity>
            
            <!-- Laser Pointer for Interaction -->
            <a-entity 
                laser-controls="hand: right" 
                raycaster="objects: .clickable; far: 10"
            ></a-entity>
        </a-entity>

        <!-- Environment -->
        <a-sky color="#ECECEC"></a-sky>
        <a-entity light="type: ambient; intensity: 0.6"></a-entity>
        <a-entity light="type: directional; intensity: 0.8; castShadow: true" position="-1 4 1"></a-entity>
        
        <!-- Ground Plane -->
        <a-entity 
            geometry="primitive: plane; width: 30; height: 30" 
            rotation="-90 0 0" 
            position="0 0 0"
            material="color: #808080; metalness: 0.1; roughness: 0.8"
            shadow="receive: true"
        ></a-entity>
        
        <!-- UI Elements -->
        <a-entity class="ui-container">
            <a-text 
                value="Architectural Walkthrough" 
                position="0 2.2 -1.5" 
                color="#222" 
                align="center"
                scale="2 2 2"
            ></a-text>
        </a-entity>
    </a-scene>

    <script src="./libs/fas.js"></script>
	<script type="module">
        import { App } from './app.js';
        
        document.addEventListener("DOMContentLoaded", function() {
            // Get loading elements
            const loadingScreen = document.getElementById('loading-screen');
            const progressBar = document.getElementById('progress');
            
            // Scene load handler
            const scene = document.querySelector('a-scene');
            scene.addEventListener('loaded', function() {
                // Model load handler
                const model = document.querySelector('#arch-model');
                model.addEventListener('model-loaded', () => {
                    // Animate progress bar
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 5;
                        progressBar.style.width = `${progress}%`;
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            loadingScreen.style.display = 'none';
                            
                            // Initialize your app
                            const app = new App(scene);
                            window.app = app;
                        }
                    }, 50);
                });
            });
        });
	</script>
</body>
</html>